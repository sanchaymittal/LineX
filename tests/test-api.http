# LineX DeFi API Testing
# Use with VS Code REST Client extension or any HTTP client
# Base URL: http://localhost:3000 (development) or https://linex.vercel.app (production)

@baseUrl = http://localhost:3000
@testUser = 0x742d35Cc8C29B3C4C4f0e9E0E0b24C2c2e5C5e5C
@testAmount = 1000000000
@testShares = 1000000000
@testSignature = 0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1b
@testNonce = 1
@testDeadline = 1735689600
@authToken = test-jwt-token

###############################################################################
# HEALTH & STATUS CHECKS
###############################################################################

### Health Check
GET {{baseUrl}}/health

### API Root - Check all endpoints
GET {{baseUrl}}/

###############################################################################
# AUTHENTICATION SETUP (Required for all DeFi endpoints)
###############################################################################

### Get user session (wallet connection simulation)
POST {{baseUrl}}/api/v1/wallet/{{testUser}}
Content-Type: application/json

{
  "address": "{{testUser}}"
}

###############################################################################
# CORE VAULT OPERATIONS
###############################################################################

### 1. Get Vault APY
GET {{baseUrl}}/api/v1/defi/vault/apy
Authorization: Bearer {{authToken}}

### 2. Get Vault Strategies
GET {{baseUrl}}/api/v1/defi/vault/strategies
Authorization: Bearer {{authToken}}

### 3. Get User SY Vault Balance
GET {{baseUrl}}/api/v1/defi/vault/balance/{{testUser}}
Authorization: Bearer {{authToken}}

### 4. Deposit to SY Vault (User-Authorized)
POST {{baseUrl}}/api/v1/defi/vault/deposit
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "amount": "{{testAmount}}",
  "signature": "{{testSignature}}",
  "nonce": {{testNonce}},
  "deadline": {{testDeadline}}
}

### 5. Withdraw from SY Vault (User-Authorized) 
POST {{baseUrl}}/api/v1/defi/vault/withdraw
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "shares": "{{testShares}}",
  "signature": "{{testSignature}}",
  "nonce": 2,
  "deadline": {{testDeadline}}
}

###############################################################################
# PYT/NYT OPERATIONS
###############################################################################

### 6. Split SY Shares → PYT + NYT (1:1 Economics)
POST {{baseUrl}}/api/v1/defi/split
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "syShares": "{{testShares}}",
  "signature": "{{testSignature}}",
  "nonce": 3,
  "deadline": {{testDeadline}}
}

### 7. Recombine PYT + NYT → SY Shares
POST {{baseUrl}}/api/v1/defi/recombine
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "pytAmount": "{{testAmount}}",
  "nytAmount": "{{testAmount}}",
  "signature": "{{testSignature}}",
  "nonce": 4,
  "deadline": {{testDeadline}}
}

### 8. Get User PYT/NYT Positions
GET {{baseUrl}}/api/v1/defi/positions/{{testUser}}
Authorization: Bearer {{authToken}}

### 9. Get Yield Forecast for User (30 days)
GET {{baseUrl}}/api/v1/defi/forecast/{{testUser}}?timeframe=30
Authorization: Bearer {{authToken}}

###############################################################################
# YIELD MANAGEMENT
###############################################################################

### 10. Get Pending Yield for User
GET {{baseUrl}}/api/v1/defi/yield/pending/{{testUser}}
Authorization: Bearer {{authToken}}

### 11. Claim PYT Yield (User-Authorized)
POST {{baseUrl}}/api/v1/defi/yield/claim
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "amount": "50000000",
  "signature": "{{testSignature}}",
  "nonce": 5,
  "deadline": {{testDeadline}}
}

### 12. Trigger Yield Distribution (Time-gated)
POST {{baseUrl}}/api/v1/defi/yield/distribute
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "signature": "{{testSignature}}",
  "nonce": 6,
  "deadline": {{testDeadline}}
}

### 13. Get Yield Claim History
GET {{baseUrl}}/api/v1/defi/yield/history/{{testUser}}
Authorization: Bearer {{authToken}}

###############################################################################
# NYT PRINCIPAL OPERATIONS
###############################################################################

### 14. Get NYT Status (Maturity & Protection)
GET {{baseUrl}}/api/v1/defi/nyt/status/{{testUser}}
Authorization: Bearer {{authToken}}

### 15. Get NYT Info (Principal & Timeline)
GET {{baseUrl}}/api/v1/defi/nyt/info/{{testUser}}
Authorization: Bearer {{authToken}}

### 16. Redeem NYT (After Maturity)
POST {{baseUrl}}/api/v1/defi/nyt/redeem
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "amount": "{{testAmount}}",
  "signature": "{{testSignature}}",
  "nonce": 7,
  "deadline": {{testDeadline}}
}

###############################################################################
# PORTFOLIO MANAGEMENT
###############################################################################

### 17. Create Diversified Portfolio
POST {{baseUrl}}/api/v1/defi/portfolio/create
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "assets": ["0x123...", "0x456...", "0x789..."],
  "allocations": [40, 35, 25],
  "totalAmount": "{{testAmount}}",
  "signature": "{{testSignature}}",
  "nonce": 8,
  "deadline": {{testDeadline}}
}

### 18. Get Portfolio Composition
GET {{baseUrl}}/api/v1/defi/portfolio/{{testUser}}
Authorization: Bearer {{authToken}}

### 19. Get Portfolio Performance Analytics
GET {{baseUrl}}/api/v1/defi/portfolio/performance/{{testUser}}
Authorization: Bearer {{authToken}}

### 20. Rebalance Portfolio
POST {{baseUrl}}/api/v1/defi/portfolio/rebalance
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "newAllocations": [50, 30, 20],
  "signature": "{{testSignature}}",
  "nonce": 9,
  "deadline": {{testDeadline}}
}

### 21. Redeem Portfolio Position
POST {{baseUrl}}/api/v1/defi/portfolio/redeem
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "portfolioTokens": "{{testShares}}",
  "signature": "{{testSignature}}",
  "nonce": 10,
  "deadline": {{testDeadline}}
}

###############################################################################
# AUTO-COMPOUND VAULT
###############################################################################

### 22. Get Auto-Compound Balance & Earnings
GET {{baseUrl}}/api/v1/defi/autocompound/balance/{{testUser}}
Authorization: Bearer {{authToken}}

### 23. Deposit to Auto-Compound Vault
POST {{baseUrl}}/api/v1/defi/autocompound/deposit
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "amount": "{{testAmount}}",
  "signature": "{{testSignature}}",
  "nonce": 11,
  "deadline": {{testDeadline}}
}

### 24. Withdraw from Auto-Compound Vault
POST {{baseUrl}}/api/v1/defi/autocompound/withdraw
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "shares": "{{testShares}}",
  "signature": "{{testSignature}}",
  "nonce": 12,
  "deadline": {{testDeadline}}
}

###############################################################################
# STRATEGY & ANALYTICS
###############################################################################

### 25. Get All Available Strategies
GET {{baseUrl}}/api/v1/defi/strategies
Authorization: Bearer {{authToken}}

### 26. Get Strategy APYs
GET {{baseUrl}}/api/v1/defi/strategies/apy
Authorization: Bearer {{authToken}}

### 27. Get Allocation Suggestions
GET {{baseUrl}}/api/v1/defi/strategies/suggestions
Authorization: Bearer {{authToken}}

### 28. Get Total Value Locked (TVL)
GET {{baseUrl}}/api/v1/defi/analytics/tvl
Authorization: Bearer {{authToken}}

### 29. Get Global Yield Statistics
GET {{baseUrl}}/api/v1/defi/analytics/yields
Authorization: Bearer {{authToken}}

### 30. Get User Statistics
GET {{baseUrl}}/api/v1/defi/analytics/users
Authorization: Bearer {{authToken}}

### 31. Get Performance Metrics
GET {{baseUrl}}/api/v1/defi/analytics/performance
Authorization: Bearer {{authToken}}

### 32. Get Comprehensive Analytics Summary
GET {{baseUrl}}/api/v1/defi/analytics/summary
Authorization: Bearer {{authToken}}

###############################################################################
# ERROR HANDLING TESTS
###############################################################################

### Test Invalid Address Format
GET {{baseUrl}}/api/v1/defi/vault/balance/invalid-address
Authorization: Bearer {{authToken}}

### Test Missing Authorization
GET {{baseUrl}}/api/v1/defi/vault/apy

### Test Invalid Signature Format
POST {{baseUrl}}/api/v1/defi/vault/deposit
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "amount": "{{testAmount}}",
  "signature": "invalid-signature",
  "nonce": {{testNonce}},
  "deadline": {{testDeadline}}
}

### Test Expired Deadline
POST {{baseUrl}}/api/v1/defi/vault/deposit
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "amount": "{{testAmount}}",
  "signature": "{{testSignature}}",
  "nonce": {{testNonce}},
  "deadline": 1609459200
}

### Test Invalid Allocation Percentages
POST {{baseUrl}}/api/v1/defi/portfolio/create
Authorization: Bearer {{authToken}}
Content-Type: application/json

{
  "assets": ["0x123...", "0x456..."],
  "allocations": [60, 50],
  "totalAmount": "{{testAmount}}",
  "signature": "{{testSignature}}",
  "nonce": 8,
  "deadline": {{testDeadline}}
}